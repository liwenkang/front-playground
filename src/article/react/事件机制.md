React 事件机制

1. 初始化渲染时,在 root 节点上注册原生事件,原生事件触发时模拟捕获,目标和冒泡阶段派发合成事件
2. 冒泡的原生事件类型最多在 root 节点上注册一些,节省内存开销
3. React 为不同事件定义了不同的处理优先级,让用户代码及时响应高优先级的用户交互,提升体验
4. 合成事件就是在符合 w3c 规范定义的前提下,抹平浏览器之间的差异化表现,简化事件逻辑,对关联事件进行合成
5. 如表单类型组件的值发生改变的时候,会触发 onChange 事件,由 change,click,input,keydown,keyup 等原生事件组成

详细

1. 原生事件触发后，进入 dispatchEvent 回调方法；
2. attemptToDispatchEvent 方法根据该原生事件查找到当前原生 Dom 节点和映射的 Fiber 节点；
3. 事件和 Fiber 等信息被派发给插件系统进行处理，插件系统调用各插件暴露的 extractEvents 方法；
4. accumulateSinglePhaseListeners 方法向上收集 Fiber 树上监听相关事件的其他回调函数，构造合成事件并加入到派发队列 dispatchQueue 中；
5. 调用 processDispatchQueue 方法，基于捕获或冒泡阶段的标识，按倒序或顺序执行 dispatchQueue 中的方法；

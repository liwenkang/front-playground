<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <style>
      .img {
        width: 400px;
        height: 400px;
        background-color: gray;
        margin-bottom: 20px;
      }

      .pic {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div class="img">
      <img
        class="pic"
        alt="加载中"
        data-src="https://upload-images.jianshu.io/upload_images/5809200-a99419bb94924e6d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"
        src=""
      />
    </div>
    <div class="img">
      <img
        class="pic"
        alt="加载中"
        data-src="https://upload-images.jianshu.io/upload_images/5809200-736bc3917fe92142.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"
      />
    </div>
    <div class="img">
      <img
        class="pic"
        alt="加载中"
        data-src="https://upload-images.jianshu.io/upload_images/5809200-7fe8c323e533f656.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"
      />
    </div>
    <div class="img">
      <img
        class="pic"
        alt="加载中"
        data-src="https://upload-images.jianshu.io/upload_images/5809200-c12521fbde6c705b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"
      />
    </div>
    <div class="img">
      <img
        class="pic"
        alt="加载中"
        data-src="https://upload-images.jianshu.io/upload_images/5809200-caf66b935fd00e18.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"
      />
    </div>
    <div class="img">
      <img
        class="pic"
        alt="加载中"
        data-src="https://upload-images.jianshu.io/upload_images/5809200-48dd99da471ffa3f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"
      />
    </div>
    <div class="img">
      <img
        class="pic"
        alt="加载中"
        data-src="https://upload-images.jianshu.io/upload_images/5809200-4de5440a56bff58f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"
      />
    </div>
    <div class="img">
      <img
        class="pic"
        alt="加载中"
        data-src="https://upload-images.jianshu.io/upload_images/5809200-03bbbd715c24750e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"
      />
    </div>
  </body>

  <script>
    const imgs = document.querySelectorAll("img[data-src]");
    const config = {
      rootMargin: "0px",
      threshold: 0,
    };
    let observer = new IntersectionObserver((entries, self) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          let img = entry.target;
          let src = img.getAttribute("data-src");
          if (src) {
            img.src = src;
            img.removeAttribute("data-src");
          }
          // 解除观察
          self.unobserve(entry.target);
        }
      });
    }, config);

    imgs.forEach((image) => {
      observer.observe(image);
    });

    // // 获取所有的图片标签
    // const imgs = document.getElementsByTagName("img");
    // // 获取当前可视区域的高度
    // const viewHeight =
    //   window.innerHeight || document.documentElement.clientHeight;
    // // num用于统计当前显示到了哪一张图片，避免每次都从第一张图片开始检查是否露出
    // let num = 0;

    // const lazyload = () => {
    //   console.log("滚动");
    //   for (let i = num; i < imgs.length; i++) {
    //     const top = imgs[i].getBoundingClientRect().top;

    //     if (top < viewHeight) {
    //       // 要懒加载
    //       const src = imgs[i].getAttribute("data-src");
    //       imgs[i].src = src;
    //       num++;
    //     }
    //   }
    // };

    // // 防抖函数
    // function debounce(fn, delay = 500) {
    //   let timer = null;
    //   return function (...args) {
    //     if (timer) clearTimeout(timer);
    //     timer = setTimeout(() => {
    //       fn.call(this, args);
    //     }, delay);
    //   };
    // }

    // // 是的页面初始化是加载首屏图片
    // // window.onload = lazyload;
    // // 监听Scroll事件，为了防止频繁调用，使用防抖函数优化一下
    // window.addEventListener("scroll", debounce(lazyload, 600), false);
  </script>
</html>
